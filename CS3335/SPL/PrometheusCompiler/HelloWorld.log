Page   1  ../PrometheusCompiler/HelloWorld.hoyo

    LC  Object    Line  Source Line
------  --------  ----  -------------------------------------------------------------
0X0000               1  ;--------------------------------------------------------------
0X0000               2  ; HelloWorld.stm
0X0000               3  ;--------------------------------------------------------------
0X0000               4  ; SVC numbers
0X0000               5  SVC_DONOTHING          EQU       0D0                  ; force context switch
0X0000               6  SVC_TERMINATE          EQU       0D1
0X0000               7  SVC_READ_INTEGER       EQU       0D10
0X0000               8  SVC_WRITE_INTEGER      EQU       0D11
0X0000               9  SVC_READ_FLOAT         EQU       0D20
0X0000              10  SVC_WRITE_FLOAT        EQU       0D21
0X0000              11  SVC_READ_BOOLEAN       EQU       0D30
0X0000              12  SVC_WRITE_BOOLEAN      EQU       0D31
0X0000              13  SVC_READ_CHARACTER     EQU       0D40
0X0000              14  SVC_WRITE_CHARACTER    EQU       0D41
0X0000              15  SVC_WRITE_ENDL         EQU       0D42
0X0000              16  SVC_READ_STRING        EQU       0D50
0X0000              17  SVC_WRITE_STRING       EQU       0D51
0X0000              18  SVC_INITIALIZE_HEAP    EQU       0D90
0X0000              19  SVC_ALLOCATE_BLOCK     EQU       0D91
0X0000              20  SVC_DEALLOCATE_BLOCK   EQU       0D92
0X0000              21  
0X0000              22                         ORG       0X0000
0X0000              23  
0X0000  800003      24                         JMP       PROGRAMMAIN
0X0003              25  ;    1 # HelloWorld.honkai
0X0003              26  ;    2 # Weiss Del Carmen
0X0003              27  ;    3 # Sample Hello World to Prometheus.
0X0003              28  ;    4 
0X0003              29  ;    5 Herrscher
0X0003              30  ;    6     Speak "Hello. Dr. MEI." >>
0X0003              31  ; **** =========
0X0003              32  ; **** PROGRAM module (   5)
0X0003              33  ; **** =========
0X0003              34  PROGRAMMAIN            EQU       *
0X0003  0100FFFE    35                         PUSH      #RUNTIMESTACK        ; set SP
0X0007  0A          36                         POPSP     
0X0008  0201005C    37                         PUSHA     STATICDATA           ; set SB
0X000C  0C          38                         POPSB     
0X000D  01000102    39                         PUSH      #HEAPBASE            ; initialize heap
0X0011  01001000    40                         PUSH      #HEAPSIZE
0X0015  FF005A      41                         SVC       #SVC_INITIALIZE_HEAP
0X0018  A0002C      42                         CALL      PROGRAMBODY0010
0X001B  020A0000    43                         PUSHA     SB:0D0
0X001F  FF0033      44                         SVC       #SVC_WRITE_STRING
0X0022  FF002A      45                         SVC       #SVC_WRITE_ENDL
0X0025  01000000    46                         PUSH      #0D0                 ; terminate with status = 0
0X0029  FF0001      47                         SVC       #SVC_TERMINATE
0X002C              48  
0X002C              49  PROGRAMBODY0010        EQU       *
0X002C              50  ;    7     Speak "I am Terminal Aide 0017." >>
0X002C              51  ; **** PRINT statement (   6)
0X002C  020A001C    52                         PUSHA     SB:0D28
0X0030  FF0033      53                         SVC       #SVC_WRITE_STRING
0X0033              54  ;    8 Stop
0X0033              55  ; **** PRINT statement (   7)
0X0033              56  ;    9 
Page   2  ../PrometheusCompiler/HelloWorld.hoyo

    LC  Object    Line  Source Line
------  --------  ----  -------------------------------------------------------------
0X0033  020A0023    57                         PUSHA     SB:0D35
0X0037  FF0033      58                         SVC       #SVC_WRITE_STRING
0X003A  A1          59                         RETURN    
0X003B              60  ; **** =========
0X003B              61  ; **** END (   8)
0X003B              62  ; **** =========
0X003B              63  
0X003B              64  ;------------------------------------------------------------
0X003B              65  ; Issue "Run-time error #X..X near line #X..X" to handle run-time errors
0X003B              66  ;------------------------------------------------------------
0X003B              67  HANDLERUNTIMEERROR     EQU       *
0X003B  FF002A      68                         SVC       #SVC_WRITE_ENDL
0X003E  020A0033    69                         PUSHA     SB:0D51
0X0042  FF0033      70                         SVC       #SVC_WRITE_STRING
0X0045  FF000B      71                         SVC       #SVC_WRITE_INTEGER
0X0048  020A0045    72                         PUSHA     SB:0D69
0X004C  FF0033      73                         SVC       #SVC_WRITE_STRING
0X004F  FF000B      74                         SVC       #SVC_WRITE_INTEGER
0X0052  FF002A      75                         SVC       #SVC_WRITE_ENDL
0X0055  01000001    76                         PUSH      #0D1
0X0059  FF0001      77                         SVC       #SVC_TERMINATE
0X005C              78  
0X005C              79  ;------------------------------------------------------------
0X005C              80  ; Static allocation of global data and PROGRAM module data
0X005C              81  ;------------------------------------------------------------
0X005C              82  STATICDATA             EQU       *
0X005C  001A001A    83                         DS        "Normal program termination"
0X0060  004E006F
0X0064  0072006D
0X0068  0061006C
0X006C  00200070
0X0070  0072006F
0X0074  00670072
0X0078  0061006D
0X007C  00200074
0X0080  00650072
0X0084  006D0069
0X0088  006E0061
0X008C  00740069
0X0090  006F006E
0X0094  00050005    84                         DS        " MEI."
0X0098  0020004D
0X009C  00450049
0X00A0  002E    
0X00A2  000E000E    85                         DS        "nal Aide 0017."
0X00A6  006E0061
0X00AA  006C0020
0X00AE  00410069
0X00B2  00640065
0X00B6  00200030
0X00BA  00300031
0X00BE  0037002E
0X00C2  00100010    86                         DS        "Run-time error #"
0X00C6  00520075
0X00CA  006E002D
0X00CE  00740069
Page   3  ../PrometheusCompiler/HelloWorld.hoyo

    LC  Object    Line  Source Line
------  --------  ----  -------------------------------------------------------------
0X00D2  006D0065
0X00D6  00200065
0X00DA  00720072
0X00DE  006F0072
0X00E2  00200023
0X00E6  000C000C    87                         DS        " near line #"
0X00EA  0020006E
0X00EE  00650061
0X00F2  00720020
0X00F6  006C0069
0X00FA  006E0065
0X00FE  00200023
0X0102              88  
0X0102              89  ;------------------------------------------------------------
0X0102              90  ; Heap space for dynamic memory allocation (to support future SPL syntax)
0X0102              91  ;------------------------------------------------------------
0X0102              92  HEAPBASE               EQU       *
0X0102              93  HEAPSIZE               EQU       0B0001000000000000   ; 8K bytes = 4K words
0X0102              94  
0X0102              95  ;------------------------------------------------------------
0X0102              96  ; Run-time stack
0X0102              97  ;------------------------------------------------------------
0X0102              98  RUNTIMESTACK           EQU       0XFFFE


  PC   SP TOS0 TOS1 TOS2 mnemonic  information
---- ---- ---- ---- ---- --------- ----------------------------------------------
0000 FFFE                 JMP       0X0003
0003 FFFE                 PUSH      #memory[EA = 0X0005] = 0XFFFE
0007 FFFC FFFE            POPSP     SP = 0XFFFE
0008 FFFE                 PUSHA     memory[EA = 0X005C]
000C FFFC 005C            POPSB     SB = 0X005C
000D FFFE                 PUSH      #memory[EA = 0X000F] = 0X0102
0011 FFFC 0102            PUSH      #memory[EA = 0X0013] = 0X1000
-------------------------------------------------------------
FREE nodes list
   0X0102:0X1101(0X0FFC)
-------------------------------------------------------------
0015 FFFA 1000 0102       SVC       #90 initialize heap, heapBase = 0X0102, heapSize = 0X1000 words
0018 FFFE                 CALL      0X002C return to 0X001B
002C FFFC 001B            PUSHA     SB( 28) memory[EA = 0X0094]
0030 FFFA 0094 001B       SVC       #51 write string
0033 FFFC 001B            PUSHA     SB( 35) memory[EA = 0X00A2]
0037 FFFA 00A2 001B       SVC       #51 write string
003A FFFC 001B            RETURN    to 0X001B
001B FFFE                 PUSHA     SB(  0) memory[EA = 0X005C]
001F FFFC 005C            SVC       #51 write string
 MEI.nal Aide 0017.Normal program termination
0022 FFFE                 SVC       #42 write ENDL
0025 FFFE                 PUSH      #memory[EA = 0X0027] = 0X0000
0029 FFFC 0000            SVC       #1 terminate program with status 0, SP = 0XFFFE

